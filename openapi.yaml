openapi: 3.0.0
info:
  title: Medication Management API
  description: API for managing medication records for care recipients
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: https://{apiId}.execute-api.{region}.amazonaws.com
    description: AWS API Gateway
    variables:
      apiId:
        default: xxxxxxxxxx
        description: Your API Gateway ID
      region:
        default: us-east-1
        description: AWS region

paths:
  /hello:
    get:
      summary: Hello endpoint
      description: Simple hello endpoint for testing
      operationId: hello
      tags:
        - Health
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Medication created (stub)"
              example:
                message: "Medication created (stub)"

  /medications:
    post:
      summary: Create a new medication record
      description: |
        Creates a new medication record for a care recipient.
        
        **Recurrence Rules:**
        - **DAILY**: Requires `timesOfDay` array (format: HH:MM), `daysOfWeek` must be null
        - **WEEKLY**: Requires `daysOfWeek` array (0-6, where 0=Sunday), `timesOfDay` must be null
      operationId: createMedication
      tags:
        - Medications
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMedicationRequest'
            examples:
              dailyMedication:
                summary: Daily medication example
                value:
                  careRecipientId: "12345"
                  name: "Ibuprofen"
                  dosage: "200mg"
                  notes: "Take with food"
                  recurrence: "DAILY"
                  timesOfDay: ["08:00", "20:00"]
                  daysOfWeek: null
                  active: true
              weeklyMedication:
                summary: Weekly medication example
                value:
                  careRecipientId: "12345"
                  name: "Vitamin D"
                  dosage: "1000 IU"
                  notes: "Take once per week"
                  recurrence: "WEEKLY"
                  timesOfDay: null
                  daysOfWeek: [1, 3, 5]
                  active: true
      responses:
        '201':
          description: Medication created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateMedicationResponse'
              example:
                medication:
                  PK: "CARE#12345"
                  SK: "MED#550e8400-e29b-41d4-a716-446655440000"
                  medicationId: "550e8400-e29b-41d4-a716-446655440000"
                  careRecipientId: "12345"
                  name: "Ibuprofen"
                  dosage: "200mg"
                  notes: "Take with food"
                  recurrence: "DAILY"
                  timesOfDay: ["08:00", "20:00"]
                  daysOfWeek: null
                  active: true
                  createdAt: "2025-11-20T12:00:00Z"
                  updatedAt: "2025-11-20T12:00:00Z"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingField:
                  summary: Missing required field
                  value:
                    error: "careRecipientId is required"
                invalidRecurrence:
                  summary: Invalid recurrence configuration
                  value:
                    error: "timesOfDay is required when recurrence is DAILY"
                invalidTimeFormat:
                  summary: Invalid time format
                  value:
                    error: "Invalid time format: 25:00. Expected format: HH:MM"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Internal server error"

components:
  schemas:
    Recurrence:
      type: string
      enum: [DAILY, WEEKLY]
      description: Medication recurrence pattern
      example: "DAILY"

    CreateMedicationRequest:
      type: object
      required:
        - careRecipientId
        - name
        - dosage
        - recurrence
      properties:
        careRecipientId:
          type: string
          description: Unique identifier for the care recipient
          example: "12345"
        name:
          type: string
          description: Name of the medication
          example: "Ibuprofen"
        dosage:
          type: string
          description: Dosage information
          example: "200mg"
        notes:
          type: string
          description: Additional notes or instructions
          example: "Take with food"
        recurrence:
          $ref: '#/components/schemas/Recurrence'
        timesOfDay:
          type: array
          items:
            type: string
            pattern: '^([0-1][0-9]|2[0-3]):[0-5][0-9]$'
            description: Time in HH:MM format (24-hour)
            example: "08:00"
          description: |
            Array of times when medication should be taken.
            Required when recurrence is DAILY, must be null for WEEKLY.
          nullable: true
          example: ["08:00", "20:00"]
        daysOfWeek:
          type: array
          items:
            type: integer
            minimum: 0
            maximum: 6
            description: |
              Day of week (0=Sunday, 1=Monday, 2=Tuesday, 3=Wednesday, 
              4=Thursday, 5=Friday, 6=Saturday)
            example: 1
          description: |
            Array of days when medication should be taken.
            Required when recurrence is WEEKLY, must be null for DAILY.
          nullable: true
          example: [1, 3, 5]
        active:
          type: boolean
          description: Whether the medication is currently active
          default: true
          example: true

    Medication:
      type: object
      properties:
        PK:
          type: string
          description: Partition key (Care Recipient ID)
          example: "CR#12345"
        SK:
          type: string
          description: Sort key (Medication ID)
          example: "MED#98765"
        medicationId:
          type: string
          description: Unique medication identifier
          example: "98765"
        careRecipientId:
          type: string
          description: Unique identifier for the care recipient
          example: "12345"
        name:
          type: string
          description: Name of the medication
          example: "Ibuprofen"
        dosage:
          type: string
          description: Dosage information
          example: "200mg"
        notes:
          type: string
          description: Additional notes or instructions
          example: "Take with food"
        recurrence:
          $ref: '#/components/schemas/Recurrence'
        timesOfDay:
          type: array
          items:
            type: string
          nullable: true
          description: Array of times when medication should be taken (for DAILY recurrence)
          example: ["08:00", "20:00"]
        daysOfWeek:
          type: array
          items:
            type: integer
          nullable: true
          description: Array of days when medication should be taken (for WEEKLY recurrence)
          example: [1, 3, 5]
        active:
          type: boolean
          description: Whether the medication is currently active
          example: true
        createdAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the medication was created
          example: "2025-11-20T12:00:00Z"
        updatedAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the medication was last updated
          example: "2025-11-20T12:00:00Z"

    CreateMedicationResponse:
      type: object
      properties:
        medication:
          $ref: '#/components/schemas/Medication'

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: "Validation error message"

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: API key for authentication (if required)

